<section>
    <h1>Astro</h1>

    <h2 data-key="welcome"></h2>

    <p data-key="navigation.home"></p>
    <p data-key="navigation.about"></p>
    <p data-key="navigation.services"></p>

    <select id="lang-select"></select>
</section>

<script>
    import {
        tStore,
        setLanguage,
        getAvailableLanguages,
        getCurrentLanguage,
    } from "tradux";

    const select = document.getElementById("lang-select") as HTMLSelectElement;
    const languages = await getAvailableLanguages();

    languages.forEach((lang: string) => {
        const option = document.createElement("option");
        option.value = lang;
        option.textContent = lang;
        option.selected = lang === getCurrentLanguage();
        select.appendChild(option);
    });

    select.onchange = (e: Event) =>
        setLanguage((e.target as HTMLSelectElement).value);

    tStore.subscribe((t: Record<string, any>) => {
        document.querySelectorAll("[data-key]").forEach((el: Element) => {
            const key = el instanceof HTMLElement ? el.dataset.key : undefined;
            const keys = key?.split(".") ?? [];
            let value = t;
            keys.forEach((k) => (value = value?.[k]));
            if (el instanceof HTMLElement) {
                el.textContent = typeof value === "string" ? value : "";
            }
        });
    });
</script>
